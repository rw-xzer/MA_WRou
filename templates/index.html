<!doctype html>
{% extends "base.html" %} {% load static %} {% block extra_head %}
<link rel="stylesheet" href="{% static 'app.css' %}" />
{% endblock %} {% block content %}
<main class="flex">
  <!-- Left Main Section -->
  <section class="relative left-0 flex h-[91.7dvh] w-[61.8vw] flex-col">
    <!-- Last Week Recap Section -->
    <section class="flex flex-col bg-inherit px-4 py-4">
      <h1 class="mb-4 text-[2em] font-bold">Last Week Recap</h1>
      <div id="recapStatBoxes" class="mb-2 flex gap-4">
        <!-- Clock Icon Card -->
        <div
          class="flex items-center gap-2 rounded-lg border border-black bg-white px-4 py-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="h-6 w-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
            />
          </svg>
          <span id="hoursCard" class="text-sm font-medium"
            >0 hours studied last week</span
          >
        </div>
        <!-- Clipboard Icon Card -->
        <div
          class="flex items-center gap-2 rounded-lg border border-black bg-white px-4 py-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="h-6 w-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h5.25c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"
            />
          </svg>
          <span id="tasksCard" class="text-sm font-medium"
            >0 Tasks completed</span
          >
        </div>
        <!-- Flame Icon Card -->
        <div
          class="flex items-center gap-2 rounded-lg border border-black bg-white px-4 py-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="currentColor"
            viewBox="0 0 640 640"
            class="h-6 w-6"
          >
            <!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
            <path
              d="M256.5 37.6C265.8 29.8 279.5 30.1 288.4 38.5C300.7 50.1 311.7 62.9 322.3 75.9C335.8 92.4 352 114.2 367.6 140.1C372.8 133.3 377.6 127.3 381.8 122.2C382.9 120.9 384 119.5 385.1 118.1C393 108.3 402.8 96 415.9 96C429.3 96 438.7 107.9 446.7 118.1C448 119.8 449.3 121.4 450.6 122.9C460.9 135.3 474.6 153.2 488.3 175.3C515.5 219.2 543.9 281.7 543.9 351.9C543.9 475.6 443.6 575.9 319.9 575.9C196.2 575.9 96 475.7 96 352C96 260.9 137.1 182 176.5 127C196.4 99.3 216.2 77.1 231.1 61.9C239.3 53.5 247.6 45.2 256.6 37.7zM321.7 480C347 480 369.4 473 390.5 459C432.6 429.6 443.9 370.8 418.6 324.6C414.1 315.6 402.6 315 396.1 322.6L370.9 351.9C364.3 359.5 352.4 359.3 346.2 351.4C328.9 329.3 297.1 289 280.9 268.4C275.5 261.5 265.7 260.4 259.4 266.5C241.1 284.3 207.9 323.3 207.9 370.8C207.9 439.4 258.5 480 321.6 480z"
            />
          </svg>
          <span id="dailiesCard" class="text-sm font-medium"
            >Missed 0 Dailies</span
          >
        </div>
        <!-- Thumbs Up Icon Card -->
        <div
          class="flex items-center gap-2 rounded-lg border border-black bg-white px-4 py-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="h-6 w-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.1 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904"
            />
          </svg>
          <span id="bestHabitCard" class="text-sm font-medium"
            >Stopped Procrastination</span
          >
        </div>
      </div>
      <p id="recapText" class="mb-2 text-sm text-gray-600">Loading recap...</p>
      <div id="recapContainer" class="flex gap-4 overflow-x-auto pb-2">
        <!-- Standout recap items will be loaded here (horizontally scrollable) -->
      </div>
    </section>

    <!-- Search and Action Bar -->
    <section
      class="flex h-[7.6dvh] items-center justify-center border-b border-gray-200 bg-inherit px-4"
    >
      <div class="flex w-full items-center gap-4">
        <input
          type="text"
          id="search"
          placeholder="Search..."
          class="flex-1 rounded-xl border border-black bg-gray-100 px-4 py-2"
        />
        <div class="relative">
          <button
            id="tagsIcon"
            class="flex items-center gap-2 rounded-xl border border-black bg-gray-100 px-4 py-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="h-5 w-5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75"
              />
            </svg>
            Tags
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="h-4 w-4"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="m19.5 8.25-7.5 7.5-7.5-7.5"
              />
            </svg>
          </button>
          <div
            id="tagsDropdown"
            class="absolute right-0 z-50 mt-2 hidden w-64 rounded-lg border border-black bg-white shadow-lg"
          >
            <div class="p-2">
              <div id="tagsList">
                <!-- Tags will be dynamically inserted here -->
              </div>
            </div>
          </div>
        </div>
        <button
          id="addTaskBtn"
          class="flex items-center gap-2 rounded-xl border border-black bg-blue-500 px-4 py-2 text-white"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="h-5 w-5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 4.5v15m7.5-7.5h-15"
            />
          </svg>
          Add Task
        </button>
      </div>
    </section>

    <!-- Main Content (Habits and Tasks) -->
    <section class="flex flex-1 overflow-hidden">
      <!-- Habits Section -->
      <section
        class="flex w-1/2 flex-col border-r border-gray-200 bg-inherit px-4 py-4"
      >
        <div class="mb-4 flex items-center justify-between">
          <h2 class="text-xl font-bold">Habits</h2>
          <div class="flex gap-2 text-sm">
            <button class="habit-filter font-medium" data-filter="all">
              All
            </button>
            <span>|</span>
            <button class="habit-filter font-medium" data-filter="weak">
              Weak
            </button>
            <span>|</span>
            <button class="habit-filter font-medium" data-filter="strong">
              Strong
            </button>
          </div>
        </div>
        <button
          id="addHabitBtn"
          class="mb-4 rounded-xl border border-black bg-gray-100 px-4 py-2 text-left"
        >
          Add a Habit
        </button>
        <div id="habitsContainer" class="flex flex-col gap-3 overflow-y-auto">
          <!-- Habits will be inserted here -->
        </div>
      </section>

      <!-- Tasks Section -->
      <section class="flex w-1/2 flex-col bg-inherit px-4 py-4">
        <div class="mb-4 flex items-center justify-between">
          <h2 class="text-xl font-bold">Tasks</h2>
          <div class="flex gap-2 text-sm">
            <button class="task-filter font-medium" data-filter="all">
              All
            </button>
            <span>|</span>
            <button class="task-filter font-medium" data-filter="scheduled">
              Scheduled
            </button>
            <span>|</span>
            <button class="task-filter font-medium" data-filter="dailies">
              Dailies
            </button>
          </div>
        </div>
        <button
          id="addTaskBtn2"
          class="mb-4 rounded-xl border border-black bg-gray-100 px-4 py-2 text-left"
        >
          Add a Task
        </button>
        <div id="tasksContainer" class="flex flex-col gap-4 overflow-y-auto">
          <!-- Tasks will be inserted here -->
        </div>
      </section>
    </section>
  </section>

  <!-- Right Sidebar (User Profile and Stats) -->
  <section
    class="absolute top-[8.3dvh] right-0 flex h-[91.7dvh] w-[38.2vw] flex-col bg-gray-50"
  >
    <!--Study Session Modal (shown when active)-->
    <div
      id="activeStudySessionModal"
      class="hidden border-b border-gray-200 bg-white px-4 py-4"
    >
      <div class="flex flex-col items-center gap-3">
        <!--Subject and Color Display-->
        <div class="flex items-center gap-2">
          <div
            id="studySessionColorIndicator"
            class="h-6 w-6 rounded-full border-2 border-black"
          ></div>
          <span id="studySessionSubject" class="text-lg font-bold"></span>
        </div>

        <!--Timer/Stopwatch Display-->
        <div class="font-mono text-4xl font-bold" id="studySessionTimer">
          00:00:00
        </div>

        <!--Control Buttons-->
        <div class="flex gap-2">
          <button
            id="studySessionPauseBtn"
            onclick="pauseStudySession()"
            class="rounded-lg border border-black bg-gray-100 px-4 py-2 hover:bg-gray-200"
          >
            <span id="studySessionPauseText">Pause</span>
          </button>
          <button
            id="studySessionStopBtn"
            onclick="stopActiveStudySession()"
            class="rounded-lg border border-black bg-gray-100 px-4 py-2 hover:bg-gray-200"
          >
            Stop
          </button>
        </div>
      </div>
    </div>

    <!-- Avatar Section -->
    <section
      class="flex h-[56.6dvh] flex-col items-center justify-center border-b border-gray-200 bg-inherit px-4 py-8"
    >
      <div
        id="avatar"
        class="avatar avatar-idle mb-6 flex h-32 w-32 items-center justify-center rounded-full bg-gray-300"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1"
          stroke="currentColor"
          class="h-20 w-20 text-gray-600"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"
          />
        </svg>
      </div>
    </section>

    <!-- Health/XP Bars -->
    <section
      class="flex h-[11.2dvh] flex-col justify-center border-b border-gray-200 bg-inherit px-4 py-4"
    >
      <div class="flex items-start gap-4">
        <!-- Left side: Health and XP bars stacked vertically -->
        <div class="flex flex-1 flex-col gap-3">
          <!-- Health Bar -->
          <div class="flex items-center gap-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="h-5 w-5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"
              />
            </svg>
            <div class="flex-1">
              <div class="h-3 w-full rounded-full bg-gray-200">
                <div
                  id="healthBar"
                  class="h-3 rounded-full bg-blue-500"
                  style="width: 100%"
                ></div>
              </div>
            </div>
            <span id="healthText" class="text-sm font-medium">50/50</span>
          </div>
          <!-- XP Bar -->
          <div class="flex items-center gap-2">
            <svg
              xmlns="http:www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="h-5 w-5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.562.562 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.562.562 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z"
              />
            </svg>
            <div class="flex-1">
              <div class="h-3 w-full rounded-full bg-gray-200">
                <div
                  id="xpBar"
                  class="h-3 rounded-full bg-blue-500"
                  style="width: 0%"
                ></div>
              </div>
            </div>
            <span id="xpText" class="text-sm font-medium">0/30</span>
          </div>
        </div>
        <!-- Right side: Coins counter -->
        <div class="flex shrink-0 items-center self-center">
          <span
            id="coinsText"
            class="text-sm font-medium whitespace-nowrap text-gray-900"
            >Coins: 0</span
          >
        </div>
      </div>
    </section>

    <!-- Stats Section -->
    <section class="flex h-[23.9dvh]">
      <section
        id="statSlot1"
        data-slot="1"
        class="stat-slot flex w-1/2 cursor-pointer flex-col items-center justify-center border-r border-black bg-gray-200 hover:bg-gray-300"
      >
        <div class="stat-value text-4xl font-bold">0</div>
        <div class="stat-label text-sm">-</div>
      </section>
      <section
        id="statSlot2"
        data-slot="2"
        class="stat-slot flex w-1/2 cursor-pointer flex-col items-center justify-center bg-gray-200 hover:bg-gray-300"
      >
        <div class="stat-value text-4xl font-bold">0</div>
        <div class="stat-label text-sm">-</div>
      </section>
    </section>
  </section>
</main>

<!-- Modals -->
<!-- Add Item Modal (Habit/Task/StudySession) -->
<div
  id="addItemModal"
  class="modal bg-opacity-50 fixed inset-0 z-50 flex hidden items-center justify-center bg-black"
>
  <div class="w-96 rounded-lg bg-white p-6">
    <h3 class="mb-4 text-xl font-bold">Add Item</h3>
    <div class="flex flex-col gap-2">
      <button
        onclick="showHabitModal(); closeModal('addItemModal');"
        class="rounded-lg border border-black bg-gray-100 px-4 py-2 text-left hover:bg-gray-200"
      >
        Add Habit
      </button>
      <button
        onclick="showTaskModal(); closeModal('addItemModal');"
        class="rounded-lg border border-black bg-gray-100 px-4 py-2 text-left hover:bg-gray-200"
      >
        Add Task
      </button>
      <button
        onclick="showStudyModal(); closeModal('addItemModal');"
        class="rounded-lg border border-black bg-gray-100 px-4 py-2 text-left hover:bg-gray-200"
      >
        Start Study Session
      </button>
    </div>
    <button
      onclick="closeModal('addItemModal')"
      class="mt-4 rounded-lg border border-black bg-gray-200 px-4 py-2"
    >
      Cancel
    </button>
  </div>
</div>

<!-- Habit Modal -->
<div
  id="habitModal"
  class="modal bg-opacity-50 fixed inset-0 z-50 flex hidden items-center justify-center overflow-y-auto bg-black py-4"
>
  <div
    class="my-auto max-h-[90vh] w-96 overflow-y-auto rounded-lg bg-white p-6"
  >
    <h3 class="mb-4 text-xl font-bold">Add Habit</h3>
    <form
      id="habitForm"
      onsubmit="event.preventDefault(); createHabitFromForm();"
    >
      <div class="mb-4">
        <label for="habitTitle" class="mb-1 block text-sm font-medium"
          >Title</label
        >
        <input
          type="text"
          id="habitTitle"
          class="w-full rounded border border-black px-3 py-2"
          required
        />
      </div>

      <div class="mb-4">
        <label for="habitDetails" class="mb-1 block text-sm font-medium"
          >Details</label
        >
        <textarea
          id="habitDetails"
          class="w-full rounded border border-black px-3 py-2"
        ></textarea>
      </div>

      <div class="mb-4">
        <label for="habitDifficulty" class="mb-1 block text-sm font-medium"
          >Difficulty</label
        >
        <select
          id="habitDifficulty"
          class="w-full rounded border border-black px-3 py-2"
        >
          <option value="trivial">Trivial</option>
          <option value="easy">Easy</option>
          <option value="medium">Medium</option>
          <option value="hard">Hard</option>
        </select>
      </div>

      <div class="mb-4">
        <label for="options" class="mb-1 block text-sm font-medium"
          >Options</label
        >
        <div class="flex flex-col gap-2">
          <label for="habitAllowPositive" class="flex items-center gap-2">
            <input
              type="checkbox"
              id="habitAllowPositive"
              checked
              class="rounded"
            />
            <span>Allow Positive</span>
          </label>
          <label for="habitAllowNegative" class="flex items-center gap-2">
            <input
              type="checkbox"
              id="habitAllowNegative"
              checked
              class="rounded"
            />
            <span>Allow Negative</span>
          </label>
        </div>
      </div>

      <div class="mb-4">
        <label for="habitResetFreq" class="mb-1 block text-sm font-medium"
          >Reset Frequency</label
        >
        <select
          id="habitResetFreq"
          class="w-full rounded border border-black px-3 py-2"
        >
          <option value="never" selected>Never</option>
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
          <option value="monthly">Monthly</option>
        </select>
      </div>

      <div class="mb-4">
        <label for="habitTagsContainer" class="mb-1 block text-sm font-medium"
          >Tags</label
        >
        <div id="habitTagsContainer" class="max-h-32 overflow-y-auto">
          <!-- Tags will be added here dynamically -->
        </div>
      </div>

      <div class="flex gap-2">
        <button
          type="submit"
          class="flex-1 rounded-lg border border-black bg-blue-500 px-4 py-2 text-white"
        >
          Create
        </button>
        <button
          type="button"
          onclick="closeModal('habitModal')"
          class="flex-1 rounded-lg border border-black bg-gray-200 px-4 py-2"
        >
          Cancel
        </button>
      </div>
      <div id="habitDeleteButton" class="mt-2 hidden">
        <button
          type="button"
          onclick="deleteHabit()"
          class="w-full rounded-lg border border-red-500 bg-red-500 px-4 py-2 text-white hover:bg-red-600"
        >
          Delete Habit
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Task Modal -->
<div
  id="taskModal"
  class="modal bg-opacity-50 fixed inset-0 z-50 flex hidden items-center justify-center overflow-y-auto bg-black py-4"
>
  <div
    class="my-auto max-h-[90vh] w-96 overflow-y-auto rounded-lg bg-white p-6"
  >
    <h3 class="mb-4 text-xl font-bold">Add Task</h3>
    <form
      id="taskForm"
      onsubmit="event.preventDefault(); createTaskFromForm();"
    >
      <div class="mb-4">
        <label for="taskTitle" class="mb-1 block text-sm font-medium"
          >Title</label
        >
        <input
          type="text"
          id="taskTitle"
          class="w-full rounded border border-black px-3 py-2"
          required
        />
      </div>

      <div class="mb-4">
        <label for="taskDetails" class="mb-1 block text-sm font-medium"
          >Details</label
        >
        <textarea
          id="taskDetails"
          class="w-full rounded border border-black px-3 py-2"
        ></textarea>
      </div>

      <div class="mb-4">
        <label for="taskType" class="mb-1 block text-sm font-medium"
          >Type</label
        >
        <select
          id="taskType"
          class="w-full rounded border border-black px-3 py-2"
          onchange="toggleTaskDateField()"
        >
          <option value="scheduled">Scheduled</option>
          <option value="daily">Daily</option>
        </select>
      </div>

      <div class="mb-4" id="taskDateField">
        <label for="taskDueDate" class="mb-1 block text-sm font-medium"
          >Due Date</label
        >
        <input
          type="datetime-local"
          id="taskDueDate"
          class="w-full rounded border border-black px-3 py-2"
        />
      </div>

      <div class="mb-4">
        <label for="taskDifficulty" class="mb-1 block text-sm font-medium"
          >Difficulty</label
        >
        <select
          id="taskDifficulty"
          class="w-full rounded border border-black px-3 py-2"
        >
          <option value="trivial">Trivial</option>
          <option value="easy">Easy</option>
          <option value="medium">Medium</option>
          <option value="hard">Hard</option>
        </select>
      </div>

      <div class="mb-4">
        <label for="taskTagsContainer" class="mb-1 block text-sm font-medium"
          >Tags</label
        >
        <div id="taskTagsContainer" class="max-h-32 overflow-y-auto">
          <!-- Tags will be added here dynamically -->
        </div>
      </div>
      <div class="flex gap-2">
        <button
          type="submit"
          class="flex-1 rounded-lg border border-black bg-blue-500 px-4 py-2 text-white"
        >
          Create
        </button>
        <button
          type="button"
          onclick="closeModal('taskModal')"
          class="flex-1 rounded-lg border border-black bg-gray-200 px-4 py-2"
        >
          Cancel
        </button>
      </div>
      <div id="taskDeleteButton" class="mt-2 hidden">
        <button
          type="button"
          onclick="deleteTask()"
          class="w-full rounded-lg border border-red-500 bg-red-500 px-4 py-2 text-white hover:bg-red-600"
        >
          Delete Task
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Study Session Modal -->
<div
  id="studyModal"
  class="modal bg-opacity-50 fixed inset-0 z-50 flex hidden items-center justify-center overflow-y-auto bg-black py-4"
>
  <div
    class="my-auto max-h-[90vh] w-96 overflow-y-auto rounded-lg bg-white p-6"
  >
    <h3 class="mb-4 text-xl font-bold">Start Study Session</h3>
    <form
      id="studyForm"
      onsubmit="event.preventDefault(); startStudyFromForm();"
    >
      <div class="mb-4">
        <label for="studySubject" class="mb-1 block text-sm font-medium"
          >Subject</label
        >
        <input
          type="text"
          id="studySubject"
          class="w-full rounded border border-black px-3 py-2"
          placeholder="e.g. Math, Science..."
          required
        />
      </div>

      <!--Color Picker-->
      <div class="mb-4">
        <label class="mb-2 block text-sm font-medium">Subject Color</label>
        <div id="baseColorPicker" class="mb-2 flex gap-2">
          <!--Base colors here-->
        </div>
        <div id="shadeColorPicker" class="grid hidden grid-cols-5 gap-2">
          <!--Shade colors here-->
        </div>
        <input type="hidden" id="selectedColor" value="#3b82f6" />
      </div>

      <div class="mb-4">
        <label for="studyMode" class="mb-1 block text-sm font-medium"
          >Mode</label
        >
        <select
          id="studyMode"
          class="w-full rounded border border-black px-3 py-2"
          onchange="toggleStudyDurationField()"
        >
          <option value="timer">Timer</option>
          <option value="stopwatch">Stopwatch</option>
        </select>
      </div>
      <div class="mb-4" id="studyDurationField">
        <label class="mb-1 block text-sm font-medium">Duration (minutes)</label>
        <input
          type="number"
          id="studyDuration"
          min="1"
          value="25"
          class="w-full rounded border border-black px-3 py-2"
        />
      </div>

      <div class="flex gap-2">
        <button
          type="submit"
          class="flex-1 rounded-lg border border-black bg-blue-500 px-4 py-2 text-white"
        >
          Start
        </button>
        <button
          type="button"
          onclick="closeModal('studyModal')"
          class="flex-1 rounded-lg border border-black bg-gray-200 px-4 py-2"
        >
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>

<!--Study Session Completion Modal-->
<div
  id="studySessionCompletionModal"
  class="modal bg-opacity-50 fixed inset-0 z-50 flex hidden items-center justify-center overflow-y-auto bg-black py-4"
>
  <div
    class="my-auto max-h-[90vh] w-96 overflow-y-auto rounded-lg bg-white p-6"
  >
    <h3 class="mb-4 text-xl font-bold">Study Session Completed!</h3>
    <div class="mb-4 space-y-3">
      <div class="flex items-center justify-between">
        <span class="text-gray-600">Hours Studied:</span>
        <span id="completionHours" class="text-lg font-bold"></span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-gray-600">XP Earned:</span>
        <span id="completionXP" class="text-lg font-bold text-green-600"
          >+0</span
        >
      </div>
      <div class="flex items-center justify-between">
        <span class="text-gray-600">Coins Earned:</span>
        <span id="completionCoins" class="text-lg font-bold text-yellow-600"
          >+0</span
        >
      </div>
    </div>
    <button
      onclick="closeModal('studySessionCompletionModal')"
      class="w-full rounded-lg border border-black bg-blue-500 px-4 py-2 text-white hover:bg-blue-600"
    >
      Great Job!
    </button>
  </div>
</div>

<!-- Stat Slot Modal -->
<div
  id="statSlotModal"
  class="modal bg-opacity-50 fixed inset-0 z-50 flex hidden items-center justify-center overflow-y-auto bg-black py-4"
>
  <div
    class="my-auto max-h-[90vh] w-96 overflow-y-auto rounded-lg bg-white p-6"
  >
    <h3 class="mb-4 text-xl font-bold">Select Stat</h3>
    <div class="flex flex-col gap-2">
      <button
        onclick="updateStatSlotFromModal('hours_studied')"
        class="rounded-lg border border-black bg-gray-100 px-4 py-2 text-left hover:bg-gray-200"
      >
        Hours Studied
      </button>
      <button
        onclick="updateStatSlotFromModal('tasks_completed')"
        class="rounded-lg border border-black bg-gray-100 px-4 py-2 text-left hover:bg-gray-200"
      >
        Tasks Completed
      </button>
      <button
        onclick="updateStatSlotFromModal('habits_completed')"
        class="rounded-lg border border-black bg-gray-100 px-4 py-2 text-left hover:bg-gray-200"
      >
        Habits Completed
      </button>
      <button
        onclick="updateStatSlotFromModal('current_streak')"
        class="rounded-lg border border-black bg-gray-100 px-4 py-2 text-left hover:bg-gray-200"
      >
        Current Streak
      </button>
      <button
        onclick="updateStatSlotFromModal('longest_streak')"
        class="rounded-lg border border-black bg-gray-100 px-4 py-2 text-left hover:bg-gray-200"
      >
        Longest Streak
      </button>
      <button
        onclick="updateStatSlotFromModal('coins_earned')"
        class="rounded-lg border border-black bg-gray-100 px-4 py-2 text-left hover:bg-gray-200"
      >
        Coins Earned
      </button>
      <button
        onclick="updateStatSlotFromModal('level')"
        class="rounded-lg border border-black bg-gray-100 px-4 py-2 text-left hover:bg-gray-200"
      >
        Level
      </button>
    </div>
    <button
      onclick="closeModal('statSlotModal')"
      class="mt-4 w-full rounded-lg border border-black bg-gray-200 px-4 py-2"
    >
      Cancel
    </button>
  </div>
</div>

<!--Pending Items Modal-->
<div
  id="pendingItemsModal"
  class="modal bg-opacity-50 fixed inset-0 z-50 flex hidden items-center justify-center overflow-y-auto bg-black py-4"
>
  <div
    class="my-auto max-h-[90vh] w-[600px] overflow-y-auto rounded-lg bg-white p-6"
  >
    <h3 class="mb-4 text-xl font-bold">Complete Yesterday's Tasks</h3>
    <p class="mb-4 text-sm text-gray-600">
      Please check off any dailies or tasks you completed yesterday.
    </p>
    <div id="pendingItemsList" class="mb-4 max-h-[400px] overflow-y-auto">
      <!--Pending items will be inserted here-->
    </div>
    <div class="flex items-center">
      <button
        type="button"
        onclick="confirmPendingItems()"
        class="flex-1 rounded-lg border border-black bg-blue-500 px-4 py-2 text-white"
      >
        Confirm
      </button>
    </div>
  </div>
</div>

<script src="{% static 'app.js' %}"></script>
<script>
  // Additional form handlers
  function createHabitFromForm() {
    const tags = Array.from(
      document.querySelectorAll(".habit-tag-checkbox:checked"),
    ).map((checkbox) => checkbox.dataset.tag);
    createHabit({
      title: document.getElementById("habitTitle").value,
      details: document.getElementById("habitDetails").value,
      difficulty: document.getElementById("habitDifficulty").value,
      allow_positive: document.getElementById("habitAllowPositive").checked,
      allow_negative: document.getElementById("habitAllowNegative").checked,
      reset_freq: document.getElementById("habitResetFreq").value,
      tags: tags,
    });
  }

  function createTaskFromForm() {
    const tags = Array.from(
      document.querySelectorAll(".task-tag-checkbox:checked"),
    ).map((checkbox) => checkbox.dataset.tag);
    const taskType = document.getElementById("taskType").value;
    let dueDate = null;

    if (taskType === "scheduled") {
      const dateInput = document.getElementById("taskDueDate").value;
      if (dateInput) {
        dueDate = new Date(dateInput).toISOString();
      }
    }

    const taskData = {
      title: document.getElementById("taskTitle").value,
      details: document.getElementById("taskDetails").value,
      task_type: taskType,
      diff: document.getElementById("taskDifficulty").value,
      tags: tags,
    };

    if (dueDate) {
      taskData.due_date = dueDate;
    }

    createTask(taskData);
  }

  function startStudyFromForm() {
    const subject = document.getElementById("studySubject").value;
    const mode = document.getElementById("studyMode").value;
    const duration =
      parseInt(document.getElementById("studyDuration").value) || 25;
    const color = document.getElementById("selectedColor").value;
    startStudySession({ subject, mode, duration, color });
  }

  function toggleStudyDurationField() {
    const mode = document.getElementById("studyMode").value;
    const durationField = document.getElementById("studyDurationField");
    if (mode === "stopwatch") {
      durationField.style.display = "none";
    } else {
      durationField.style.display = "block";
    }
  }

  function toggleTaskDateField() {
    const taskType = document.getElementById("taskType").value;
    const dateField = document.getElementById("taskDateField");
    if (taskType === "daily") {
      dateField.style.display = "none";
    } else {
      dateField.style.display = "block";
    }
  }

  function updateStatSlotFromModal(statType) {
    const modal = document.getElementById("statSlotModal");
    const slotNumber = parseInt(modal.dataset.slot);
    updateStatSlot(slotNumber, statType);
  }

  // Make functions global
  window.createHabitFromForm = createHabitFromForm;
  window.createTaskFromForm = createTaskFromForm;
  window.startStudyFromForm = startStudyFromForm;
  window.toggleTaskDateField = toggleTaskDateField;
  window.toggleStudyDurationField = toggleStudyDurationField;
  window.updateStatSlotFromModal = updateStatSlotFromModal;
  window.completeHabit = completeHabit;
  window.completeTask = completeTask;
  window.showHabitModal = showHabitModal;
  window.showTaskModal = showTaskModal;
  window.showStudyModal = showStudyModal;
  window.closeModal = closeModal;
  window.showAddItemModal = showAddItemModal;
  window.showStatSlotModal = showStatSlotModal;
  window.editHabit = editHabit;
  window.editTask = editTask;
  window.deleteHabit = deleteHabit;
  window.deleteTask = deleteTask;
  window.pauseStudySession = pauseStudySession;
  window.stopActiveStudySession = stopActiveStudySession;
  window.togglePendingItem = togglePendingItem;
  window.confirmPendingItems = confirmPendingItems;
</script>
{% endblock %}
